@page
@model IndexModel
@{
    ViewData["Title"] = "Expense Management";
}

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="error-banner">
        <strong>⚠️ Error:</strong> @Model.ErrorMessage
    </div>
}

<div class="page-header">
    <h1>Expense Management</h1>
    <div class="header-actions">
        <a href="/AddExpense" class="btn btn-primary">+ Add New Expense</a>
        <a href="/ApproveExpenses" class="btn btn-secondary">Approve Expenses</a>
        <a href="/Chat" class="btn btn-chat">💬 Chat Assistant</a>
    </div>
</div>

<div class="filter-section">
    <form method="get" class="filter-form">
        <div class="filter-group">
            <label for="FilterStatus">Status:</label>
            <select name="FilterStatus" id="FilterStatus" asp-for="FilterStatus">
                <option value="">All Statuses</option>
                @foreach (var status in Model.Statuses)
                {
                    <option value="@status.StatusName">@status.StatusName</option>
                }
            </select>
        </div>

        <div class="filter-group">
            <label for="FilterCategory">Category:</label>
            <select name="FilterCategory" id="FilterCategory" asp-for="FilterCategory">
                <option value="">All Categories</option>
                @foreach (var category in Model.Categories)
                {
                    <option value="@category.CategoryName">@category.CategoryName</option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-filter">Apply Filters</button>
        <a href="/" class="btn btn-clear">Clear</a>
    </form>
</div>

<div class="expense-grid">
    @if (Model.Expenses.Any())
    {
        @foreach (var expense in Model.Expenses)
        {
            <div class="expense-card">
                <div class="expense-header">
                    <div class="expense-category">@expense.CategoryName</div>
                    <div class="expense-status status-@expense.StatusName.ToLower()">@expense.StatusName</div>
                </div>
                
                <div class="expense-amount">@expense.FormattedAmount</div>
                
                <div class="expense-details">
                    <div class="expense-date">📅 @expense.ExpenseDate.ToString("dd MMM yyyy")</div>
                    <div class="expense-user">👤 @expense.UserName</div>
                </div>
                
                <div class="expense-description">@expense.Description</div>
                
                @if (expense.ReviewedByName != null)
                {
                    <div class="expense-reviewed">
                        Reviewed by @expense.ReviewedByName on @expense.ReviewedAt?.ToString("dd MMM yyyy")
                    </div>
                }
                
                <div class="expense-actions">
                    <a href="/EditExpense?id=@expense.ExpenseId" class="btn btn-edit">Edit</a>
                    <form method="post" asp-page-handler="Delete" asp-route-id="@expense.ExpenseId" style="display: inline;">
                        <button type="submit" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</button>
                    </form>
                </div>
            </div>
        }
    }
    else
    {
        <div class="no-expenses">
            <p>No expenses found. Add your first expense to get started!</p>
        </div>
    }
</div>
